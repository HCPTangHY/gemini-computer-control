# 测试指南

本文档说明如何测试Gemini计算机控制系统的完整流程。

## 测试前准备

### 1. 获取Gemini API密钥

1. 访问 [Google AI Studio](https://aistudio.google.com/app/apikey)
2. 登录你的Google账号
3. 点击"Create API Key"创建新密钥
4. 复制生成的API密钥

### 2. 配置环境变量

在 `backend` 目录下创建 `.env` 文件：

```bash
cd backend
copy .env.example .env
```

编辑 `.env` 文件，填入你的API密钥：

```
GEMINI_API_KEY=你的实际API密钥
```

### 3. 安装依赖

```bash
cd backend
pip install -r requirements.txt
```

## 测试步骤

### 方法一：使用启动脚本（推荐）

1. **双击运行 `start.bat`**
   - 脚本会自动检查环境
   - 安装依赖
   - 启动后端服务

2. **打开前端页面**
   - 在浏览器中打开 `frontend/index.html`
   - 或者右键点击文件 → "Open with Live Server"（如果安装了VS Code的Live Server插件）

### 方法二：手动启动

1. **启动后端服务**
   ```bash
   cd backend
   python main.py
   ```
   
   你应该看到类似输出：
   ```
   启动Gemini计算机控制后端服务...
   访问 http://localhost:5000/health 检查服务状态
   * Running on http://0.0.0.0:5000
   ```

2. **测试后端健康检查**
   
   在浏览器中访问：`http://localhost:5000/health`
   
   应该看到：
   ```json
   {
     "status": "ok",
     "message": "服务运行正常"
   }
   ```

3. **打开前端页面**
   
   在浏览器中打开 `frontend/index.html`

## 功能测试

### 1. 检查连接状态

- 打开前端页面后，查看"后端服务地址"标签旁的状态指示灯
- ✅ **绿色圆点** = 后端服务在线
- ❌ **红色圆点** = 后端服务离线

### 2. 测试截图功能

1. 点击 **"📸 截取屏幕"** 按钮
2. 浏览器会弹出屏幕共享选择框
3. 选择要截取的屏幕、窗口或标签页
4. 点击"分享"
5. 截图应该显示在"截图预览"区域
6. "🚀 发送给AI分析"按钮应该变为可用状态

### 3. 测试AI分析功能

1. （可选）在"AI指令"文本框中输入指令，例如：
   - "点击屏幕中央的按钮"
   - "找到搜索框并点击"
   - "点击最显眼的元素"

2. 点击 **"🚀 发送给AI分析"** 按钮

3. 等待AI分析（通常需要几秒钟）

4. 查看结果：
   - 成功：绿色结果框显示JSON格式的响应
   - 失败：红色结果框显示错误信息

### 4. 验证AI响应

成功的响应应该包含：

```json
{
  "success": true,
  "action": "click",
  "x": 640,
  "y": 360,
  "reasoning": "点击屏幕中央位置，这是一个常见的交互区域"
}
```

字段说明：
- `success`: 是否成功
- `action`: 操作类型（目前只支持"click"）
- `x`: 横坐标
- `y`: 纵坐标
- `reasoning`: AI的推理说明

## 常见问题排查

### 问题1：后端服务无法启动

**症状**：运行 `python main.py` 时报错

**可能原因和解决方案**：

1. **缺少依赖**
   ```bash
   pip install -r requirements.txt
   ```

2. **端口被占用**
   - 检查5000端口是否被占用
   - 修改 `main.py` 中的端口号

3. **Python版本过低**
   - 确保使用Python 3.8或更高版本
   ```bash
   python --version
   ```

### 问题2：前端无法连接后端

**症状**：状态指示灯为红色

**解决方案**：

1. 确认后端服务已启动
2. 检查后端URL是否正确（默认：`http://localhost:5000`）
3. 查看浏览器控制台的错误信息（F12）

### 问题3：截图功能不工作

**症状**：点击截图按钮没有反应或报错

**可能原因**：

1. **浏览器不支持**
   - 使用Chrome、Edge等现代浏览器
   - 确保浏览器版本较新

2. **需要HTTPS**
   - 某些浏览器要求HTTPS才能使用截图API
   - 解决方案：使用本地服务器
   ```bash
   cd frontend
   python -m http.server 8080
   ```
   然后访问 `http://localhost:8080`

### 问题4：AI分析失败

**症状**：点击分析后返回错误

**可能原因和解决方案**：

1. **API密钥未配置或错误**
   - 检查 `backend/.env` 文件
   - 确认API密钥正确

2. **网络问题**
   - 检查网络连接
   - 确认可以访问Google服务

3. **API配额用尽**
   - 检查API使用配额
   - 等待配额重置或升级账户

4. **图片过大**
   - 尝试截取较小的区域
   - 检查后端日志的详细错误信息

### 问题5：CORS错误

**症状**：浏览器控制台显示CORS相关错误

**解决方案**：

1. 确认后端已安装 `flask-cors`
2. 检查 `main.py` 中是否有 `CORS(app)`
3. 使用本地服务器而不是直接打开HTML文件

## 测试检查清单

- [ ] 后端服务成功启动
- [ ] 健康检查接口返回正常
- [ ] 前端页面正常加载
- [ ] 状态指示灯显示为绿色
- [ ] 截图功能正常工作
- [ ] 截图预览正确显示
- [ ] AI分析按钮可用
- [ ] AI成功返回坐标
- [ ] 结果显示格式正确

## 下一步

测试通过后，你可以：

1. **扩展功能**
   - 添加实际的鼠标点击执行
   - 支持更多操作类型（拖拽、输入等）
   - 添加操作历史记录

2. **优化体验**
   - 改进UI设计
   - 添加快捷键支持
   - 实现操作录制和回放

3. **部署上线**
   - 配置生产环境
   - 添加认证机制
   - 优化性能和安全性

## 获取帮助

如果遇到问题：

1. 查看后端控制台的日志输出
2. 检查浏览器控制台（F12）的错误信息
3. 参考 `README.md` 中的故障排除部分
4. 检查Gemini API文档：https://ai.google.dev/docs